<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø±Ø¶ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¬ÙˆØ¬Ùˆ - ÙˆØ§Ø¬Ù‡Ø© Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0A0A0C;
            --surface-dark: #18181B;
            --surface-light: #27272A;
            --text-primary: #F4F4F5;
            --text-secondary: #A1A1AA;
            --accent: #6366F1; /* Indigo */
        }
        html.light {
            --bg-dark: #F5F5F7;
            --surface-dark: #FFFFFF;
            --surface-light: #EAEAEF;
            --text-primary: #1D1D1F;
            --text-secondary: #6E6E73;
            --accent: #4F46E5; /* Indigo */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
        }
        body::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .popup-enter-active, .popup-exit-active { transition: opacity 300ms, transform 300ms; }
        .popup-enter-from, .popup-exit-to { opacity: 0; transform: scale(0.95); }
        .speed-option.active { background-color: var(--accent); color: white; }
        .skeleton-card {
            background-color: var(--surface-dark);
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid var(--surface-light);
        }
        .skeleton-img {
            height: 12rem;
            background-color: var(--surface-light);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse { 50% { opacity: .5; } }
        #heroProgressBar {
            transform-origin: right;
            transition: transform 0.2s linear;
        }
        
        .spinner {
            border: 4px solid var(--surface-light);
            border-left-color: var(--accent);
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #videoPopup::-webkit-scrollbar { display: none; }
        #videoPopup { scrollbar-width: none; -ms-overflow-style: none; }

        /* !!! Ø£Ù†Ù…Ø§Ø· Ø£Ø²Ø±Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ */
        .slideshow-control {
            position: fixed;
            z-index: 70;
            background-color: rgba(0, 0, 0, 0.3);
            color: white;
            border-radius: 9999px; /* rounded-full */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.3;
            transition: opacity 0.3s, background-color 0.3s;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }
        .slideshow-control:hover {
            opacity: 0.9;
        }
        #slideshowExitBtn { top: 1rem; right: 1rem; width: 40px; height: 40px; }
        #slideshowNextBtn { top: 50%; right: 1rem; transform: translateY(-50%); width: 48px; height: 48px; }
        #slideshowPrevBtn { top: 50%; left: 1rem; transform: translateY(-50%); width: 48px; height: 48px; }
        #slideshowLoopBtn { bottom: 1rem; left: 1rem; width: 40px; height: 40px; }
        #slideshowLockBtn { bottom: 1rem; right: 1rem; width: 40px; height: 40px; }
        
        .slideshow-control.active-accent {
            background-color: var(--accent);
            opacity: 0.8;
        }

        /* !!! Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù‚ÙÙ„ */
        #slideshowContainer.controls-hidden .slideshow-control {
            display: none;
        }
        #slideshowContainer.controls-hidden #slideshowLockBtn {
            display: flex;
            opacity: 0.01; /* Ø´Ø¨Ù‡ Ù…Ø®ÙÙŠ */
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            bottom: auto;
            right: auto;
            background: rgba(255, 255, 255, 0.01); /* Ù…Ù†Ø·Ù‚Ø© Ø¶ØºØ· Ø´ÙØ§ÙØ© */
            width: 200px;
            height: 50px;
            border-radius: 0 0 10px 10px;
            border: none;
            backdrop-filter: none;
        }
        #slideshowContainer.controls-hidden #slideshowLockBtn svg {
             visibility: hidden; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø· */
        }
        #slideshowContainer.controls-hidden #slideshowLockBtn:hover {
            opacity: 0.3; /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
            background: rgba(255, 255, 255, 0.1);
        }

    </style>
</head>
<body class="transition-colors duration-300">

    <!-- Password Popup -->
    <div id="passwordPopup" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-gray-900 w-full max-w-sm rounded-2xl p-8 shadow-2xl border border-gray-700">
            <h2 class="text-2xl font-bold text-center text-white mb-2">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹</h2>
            <p class="text-center text-gray-400 mb-6">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>
            <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full bg-gray-800 text-white placeholder-gray-500 rounded-lg px-4 py-3 mb-4 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
            <p id="passwordError" class="text-red-400 text-center mb-4 hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.</p>
            <button onclick="checkPassword()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg shadow-indigo-900/50">
                Ø¯Ø®ÙˆÙ„
            </button>
        </div>
    </div>
    
    <div id="contentWrapper" class="hidden">
        <!-- Hero Banner -->
        <section id="heroBanner" class="relative h-screen w-screen">
            <video id="heroVideo" class="absolute inset-0 w-full h-full object-cover" autoplay muted playsinline></video>
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            
            <div class="absolute top-0 left-0 p-6 z-20">
                 <button id="heroMuteBtn" title="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª" class="h-12 w-12 flex items-center justify-center bg-white/10 backdrop-blur-md rounded-full text-white hover:bg-white/20 transition-all shadow-lg shadow-black/30">
                     <svg id="hero-unmute-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                     <svg id="hero-mute-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
                 </button>
            </div>

            <div class="absolute bottom-0 left-0 p-6 z-20">
                <button id="heroPlayBtn" class="px-5 py-2 flex items-center gap-2 bg-white/10 backdrop-blur-md rounded-lg text-white font-semibold hover:bg-white/20 transition-all shadow-lg shadow-black/30">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    <span>ØªØ´ØºÙŠÙ„</span>
                </button>
            </div>
            
            <div class="absolute bottom-0 left-0 w-full h-1 bg-white/20 z-10 pointer-events-none">
                <div id="heroProgressBar" class="h-full bg-white" style="transform: scaleX(0);"></div>
            </div>
        </section>

        <!-- Main Content -->
        <div id="mainContent" class="relative z-10 bg-[var(--bg-dark)]">
            <header id="appHeader" class="sticky top-0 z-30 py-4 px-4 sm:px-6 lg:px-8 bg-[var(--bg-dark)]/80 backdrop-blur-xl transition-all duration-500 border-b border-[var(--surface-light)] opacity-0 -translate-y-full">
                <div class="max-w-7xl mx-auto flex justify-between items-center gap-4">
                    <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Jojo Gallery</h1>
                </div>
            </header>

            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" id="filterInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙÙŠØ¯ÙŠÙˆ..." class="w-full bg-[var(--surface-dark)] border border-[var(--surface-light)] text-[var(--text-primary)] placeholder-[var(--text-secondary)] rounded-lg pl-12 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-[var(--accent)] transition">
                         <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                             <svg class="h-5 w-5 text-[var(--text-secondary)]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                         </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
                <div class="flex flex-wrap justify-center gap-3 mb-8">
                    <button id="fullscreenBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg id="fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
                        <svg id="exit-fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>
                        <span>Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</span>
                    </button>
                    
                    <button onclick="playRandomVideo()" title="ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø¹Ø´ÙˆØ§Ø¦ÙŠ" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                        <span>Ø¹Ø´ÙˆØ§Ø¦ÙŠ</span>
                    </button>
                    
                    <button onclick="startRandomSlideshow()" title="ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 3 7 7-7 7m18-7h-9"></path><path d="m14 3 7 7-7 7"></path></svg>
                        <span>ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙ„</span>
                    </button>
                    
                    <button onclick="startPomfSlideshow()" title="ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Pomf ÙÙ‚Ø·" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 3 7 7-7 7m18-7h-9"></path><path d="m14 3 7 7-7 7"></path></svg>
                        <span>ØªØ´ØºÙŠÙ„ Pomf</span>
                    </button>

                    <button onclick="shuffleDisplayedVideos()" title="Ø®Ù„Ø· Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        <span>Ø®Ù„Ø· Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶</span>
                    </button>
                    
                    <button id="sortDurationBtn" onclick="toggleSortByDuration()" title="ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯Ø©" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
                        <span id="sortDurationText">ÙØ±Ø²: Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>
                    </button>
                    
                    <button onclick="openInfoPopup()" title="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
                    </button>
                    
                    <button onclick="toggleTheme()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±" class="flex items-center justify-center gap-2 h-11 px-4 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-all text-sm font-medium">
                        <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                        <span id="theme-text">Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„ÙØ§ØªØ­</span>
                    </button>
                </div>

                <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
                <div id="videoContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                <div id="loadingIndicator" class="text-center py-12"></div>
                <div class="text-center py-12">
                    <button id="loadMoreButton" onclick="loadMoreVideos()" class="bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] text-[var(--text-primary)] font-semibold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 border border-[var(--surface-light)] hidden">
                        ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
                    </button>
                </div>
            </main>

            <footer class="text-center py-10 mt-12 border-t border-[var(--surface-dark)]">
                <p class="text-[var(--text-secondary)]">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ù€ â¤ï¸ Ø¨ÙˆØ§Ø³Ø·Ø© <a href="https://twitter.com/vvrlox" target="_blank" class="text-[var(--accent)] hover:underline font-semibold">@vvrlox</a></p>
            </footer>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
    <div id="videoPopup" class="fixed inset-0 bg-black/80 backdrop-blur-xl flex justify-center overflow-y-auto z-40 p-4 sm:py-10 opacity-0 invisible transition-opacity duration-300">
        <div id="videoPopupContent" class="w-full max-w-6xl bg-[var(--surface-dark)] rounded-2xl shadow-2xl border border-[var(--surface-light)] m-auto popup-enter-from">
            
            <div id="videoContainerPopup" class="w-full aspect-video bg-black relative rounded-t-2xl sticky top-0 z-10">
                <!-- Video injected here -->
            </div>
            
            <div class="p-4 border-t border-[var(--surface-light)]">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                     <div class="flex items-center gap-2">
                         <button id="shareButton" onclick="shareVideo()" title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·" class="p-2 rounded-full bg-white/5 hover:bg-white/10 text-gray-300 transition-all active:scale-95 active:bg-[var(--accent)]/50"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg></button>
                         <button id="filterToggleButton" onclick="toggleFilterSection()" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ„Ø§ØªØ±" class="p-2 rounded-full bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-all"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg></button>
                         <button id="loopButton" onclick="toggleLoop()" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„" class="p-2 rounded-full bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-all"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 12.2v-2a4 4 0 0 1 4-4h12"/><path d="M7 21.9l-4-4 4-4"/><path d="M21 11.8v2a4 4 0 0 1-4 4H5"/></svg></button>
                         <button onclick="closePopup()" title="Ø¥ØºÙ„Ø§Ù‚ (Esc)" class="p-2 rounded-full bg-red-600/20 hover:bg-red-600/40 text-red-400 transition-all"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                     </div>
                     <div class="flex items-center gap-2 sm:gap-4">
                         <div class="relative group">
                             <button class="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 transition-all flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg><span id="speedButtonText">1x</span></button>
                             <div class="absolute bottom-full mb-2 right-1/2 translate-x-1/2 w-40 bg-[var(--surface-light)] border border-white/10 rounded-lg shadow-xl p-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-10"><button class="speed-option w-full text-left px-3 py-2 rounded-md hover:bg-white/5" data-speed="0.5" onclick="setPlaybackSpeed(0.5)">0.5x</button><button class="speed-option w-full text-left px-3 py-2 rounded-md hover:bg-white/5 active" data-speed="1" onclick="setPlaybackSpeed(1)">1x (Normal)</button><button class="speed-option w-full text-left px-3 py-2 rounded-md hover:bg-white/5" data-speed="1.5" onclick="setPlaybackSpeed(1.5)">1.5x</button><button class="speed-option w-full text-left px-3 py-2 rounded-md hover:bg-white/5" data-speed="2" onclick="setPlaybackSpeed(2)">2x</button></div>
                         </div>
                     </div>
                </div>
            </div>
            
            <div id="filterOptions" class="p-6 border-t border-[var(--surface-light)] space-y-5 hidden">
                <h3 class="text-xl font-semibold text-[var(--text-primary)]">ÙÙ„Ø§ØªØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h3>
                <div id="filterSlidersContainer" class="space-y-4"><!-- Sliders injected here --></div>
                <button class="w-full mt-4 py-3 rounded-lg bg-[var(--surface-dark)] hover:bg-[var(--surface-light)] border border-[var(--surface-light)] text-[var(--text-primary)] transition font-semibold" onclick="resetFilters()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±</button>
            </div>

        </div>
    </div>

    <!-- Info Popup -->
    <div id="infoPopup" class="fixed inset-0 bg-black/80 backdrop-blur-xl flex items-center justify-center z-50 p-4 opacity-0 invisible transition-opacity duration-300">
        <div class="bg-[var(--surface-dark)] w-full max-w-md rounded-2xl p-8 shadow-2xl border border-[var(--surface-light)] text-center popup-enter-from">
            <h2 class="text-2xl font-bold text-white mb-4">Ù…ÙŠÙ† Ø¬ÙˆØ¬ÙˆØŸ</h2>
            <p class="text-[var(--text-secondary)] mb-2">ğŸ’ Ø¬ÙˆØ¬Ùˆ Ø¹Ù†Ø¯Ù‡Ø§ Ø§Ø¬Ù…Ù„ ÙˆØ§ÙƒØ«Ø± Ø¯ÙŠØ¯ Ø¨ÙŠØ±ÙÙƒØª Ø¨ØªÙˆÙŠØªØ±</p>
            <p class="text-[var(--text-secondary)] mb-6">@inonrr | @sinuw8 :Ø­Ø³Ø§Ø¨Ø§ØªÙ‡Ø§</p>
            <p class="text-xs text-gray-500">Created with â¤ï¸ by <a href="https://twitter.com/vvrlox" target="_blank" class="text-[var(--accent)] hover:underline font-semibold">@vvrlox</a></p>
            <button onclick="closeInfoPopup()" class="mt-6 w-full bg-[var(--accent)]/90 hover:bg-[var(--accent)] text-white font-bold py-3 px-4 rounded-lg transition-all">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Custom Notification -->
    <div id="notification" class="fixed top-5 right-5 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300 z-50">
        <p id="notificationMessage"></p>
    </div>

    <!-- !!! Ø­Ø§ÙˆÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ (Ù…ÙØ­Ø¯Ù‘Ø«Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„) -->
    <div id="slideshowContainer" class="fixed inset-0 bg-black z-[60] hidden">
        <video id="slideshowVideo" class="w-full h-full object-contain" autoplay playsinline></video>
        
        <!-- Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ -->
        <button id="slideshowExitBtn" onclick="stopRandomSlideshow()" title="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¹Ø±Ø¶ (Esc)" class="slideshow-control">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>

        <!-- Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ -->
        <button id="slideshowNextBtn" onclick="playNextSlideshowVideo()" title="Ø§Ù„ØªØ§Ù„ÙŠ" class="slideshow-control">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </button>
        
        <!-- Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ -->
        <button id="slideshowPrevBtn" onclick="playPrevSlideshowVideo()" title="Ø§Ù„Ø³Ø§Ø¨Ù‚" class="slideshow-control">
             <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </button>
        
        <!-- Ø²Ø± Ø§Ù„ØªÙƒØ±Ø§Ø± -->
        <button id="slideshowLoopBtn" onclick="toggleSlideshowLoop()" title="ØªÙƒØ±Ø§Ø±" class="slideshow-control">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 12.2v-2a4 4 0 0 1 4-4h12"/><path d="M7 21.9l-4-4 4-4"/><path d="M21 11.8v2a4 4 0 0 1-4 4H5"/></svg>
        </button>
        
        <!-- Ø²Ø± Ø§Ù„Ù‚ÙÙ„ -->
        <button id="slideshowLockBtn" onclick="toggleSlideshowLock()" title="Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø£Ø²Ø±Ø§Ø±" class="slideshow-control">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…ÙØªÙˆØ­ -->
            <svg id="lock-open-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…ØºÙ„Ù‚ -->
            <svg id="lock-closed-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        </button>
    </div>

    <script>
    // --- STATE & CONFIG ---
    let allVideos = [];
    let heroPlaylist = [];
    let currentHeroIndex = 0;
    let loadedVideosCount = 0;
    const videosPerLoad = 12;
    let currentSpeed = 1;
    let isHeroMuted = true;
    const defaultFilterSettings = { brightness: 100, contrast: 100, saturate: 100, 'hue-rotate': 0, blur: 0 };
    let filterSettings = { ...defaultFilterSettings };
    const videosUrl = "https://raw.githubusercontent.com/Aminoxdag/catbox-inonrr/refs/heads/main/inonrr.txt";
    let currentSortState = -1; // -1: random (initial), 0: A-Z, 1: Longest, 2: Shortest

    // --- SLIDESHOW STATE ---
    let isSlideshowActive = false;
    let slideshowPlaylist = [];
    let currentSlideshowIndex = 0;
    let isSlideshowLooping = false; // !!! Ø­Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
    let isSlideshowLocked = false; // !!! Ø­Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„

    // --- DOM ELEMENTS ---
    const getEl = (id) => document.getElementById(id);
    const passwordPopup = getEl('passwordPopup');
    const passwordInput = getEl('passwordInput');
    const passwordError = getEl('passwordError');
    const contentWrapper = getEl('contentWrapper');
    const heroBanner = getEl('heroBanner');
    const heroVideo = getEl('heroVideo');
    const heroMuteBtn = getEl('heroMuteBtn');
    const heroPlayBtn = getEl('heroPlayBtn');
    const heroProgressBar = getEl('heroProgressBar');
    const mainContent = getEl('mainContent');
    const filterInput = getEl('filterInput');
    const videoContainer = getEl('videoContainer');
    const loadingIndicator = getEl('loadingIndicator');
    const loadMoreButton = getEl('loadMoreButton');
    const videoPopup = getEl('videoPopup');
    const videoPopupContent = getEl('videoPopupContent');
    const videoContainerPopup = getEl('videoContainerPopup');
    const infoPopup = getEl('infoPopup');
    const loopButton = getEl('loopButton');
    const speedButtonText = getEl('speedButtonText');
    const filterOptionsContainer = getEl('filterOptions');
    const notification = getEl('notification');
    const notificationMessage = getEl('notificationMessage');
    const appHeader = getEl('appHeader');
    const fullscreenBtn = getEl('fullscreenBtn');
    const fullscreenIcon = getEl('fullscreen-icon');
    const exitFullscreenIcon = getEl('exit-fullscreen-icon');
    const themeText = getEl('theme-text');
    const filterSlidersContainer = getEl('filterSlidersContainer');
    // --- SLIDESHOW DOM ---
    const slideshowContainer = getEl('slideshowContainer');
    const slideshowVideo = getEl('slideshowVideo');
    const slideshowLoopBtn = getEl('slideshowLoopBtn');
    const slideshowLockBtn = getEl('slideshowLockBtn');
    const lockOpenIcon = getEl('lock-open-icon');
    const lockClosedIcon = getEl('lock-closed-icon');


    // --- NOTIFICATION ---
    function showNotification(message, isError = true) {
        notificationMessage.textContent = message;
        notification.className = `fixed top-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300 z-50 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
        notification.classList.remove('opacity-0', 'translate-y-10');
        setTimeout(() => {
            notification.classList.add('opacity-0', 'translate-y-10');
        }, 3000);
    }

    // --- AUTH & INITIALIZATION ---
    async function initializeApp() {
        renderSkeletonLoaders();
        try {
            const response = await fetch(videosUrl);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const text = await response.text();
            const urls = text.split('\n').filter(url => url.trim() !== '' && (url.includes('.mp4') || url.includes('.webm')));
            
            const videos = urls.map(url => ({
                src: url,
                title: url.split('/').pop().replace(/\.[^/.]+$/, "").replace(/[-_]/g, ' '),
                duration: 0 
            }));
            allVideos = [...videos].sort(() => Math.random() - 0.5); // Start random
            heroPlaylist = [...videos].sort(() => Math.random() - 0.5);

            currentSortState = -1; // -1 = random
            if(getEl('sortDurationText')) getEl('sortDurationText').textContent = "ÙØ±Ø²: Ø¹Ø´ÙˆØ§Ø¦ÙŠ";


            setupHeroBanner();
            loadingIndicator.innerHTML = '';
            videoContainer.innerHTML = ''; // Clear skeletons
            loadMoreVideos();

        } catch (error) {
            console.error("Failed to fetch videos:", error);
            loadingIndicator.innerHTML = '<p class="text-red-400">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>';
            showNotification("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.");
        }
    }

    function checkPassword() {
        if (passwordInput.value === "1432145") {
            passwordPopup.classList.add('opacity-0', 'invisible');
            setTimeout(() => {
                passwordPopup.classList.add('hidden');
                contentWrapper.classList.remove('hidden');
                loadAndApplyTheme();
                initializeApp();
            }, 300);
        } else {
            passwordError.classList.remove('hidden');
            passwordInput.value = "";
            passwordInput.focus();
        }
    }
    passwordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkPassword(); });

    // --- HERO BANNER ---
    function setupHeroBanner() {
        if (heroPlaylist.length > 0) {
            playNextHeroVideo();
        }
    }
    
    function playNextHeroVideo() {
        if (heroPlaylist.length === 0) return;
        heroVideo.src = heroPlaylist[currentHeroIndex].src;
        heroVideo.muted = isHeroMuted; 
        heroVideo.play().catch(()=>{});
        currentHeroIndex = (currentHeroIndex + 1) % heroPlaylist.length;
        updateMuteIcon();
    }

    function updateMuteIcon() {
        heroVideo.muted = isHeroMuted;
        getEl('hero-unmute-icon').classList.toggle('hidden', isHeroMuted);
        getEl('hero-mute-icon').classList.toggle('hidden', !isHeroMuted);
    }

    heroVideo.addEventListener('ended', playNextHeroVideo);
    heroVideo.addEventListener('timeupdate', () => {
        if (heroVideo.duration) {
            const progress = (heroVideo.currentTime / heroVideo.duration);
            heroProgressBar.style.transform = `scaleX(${progress})`;
        }
    });
    
    heroPlayBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const currentHeroVideoSrc = heroVideo.src; 
        heroVideo.pause(); 
        if (currentHeroVideoSrc) {
            openPopup(currentHeroVideoSrc); 
        }
    });

    heroMuteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        isHeroMuted = !isHeroMuted;
        updateMuteIcon();
    });

    // --- THEME ---
    function applyTheme(theme) {
        document.documentElement.className = theme;
        getEl('theme-icon-sun').classList.toggle('hidden', theme === 'light');
        getEl('theme-icon-moon').classList.toggle('hidden', theme === 'dark');
        if (themeText) {
            themeText.textContent = theme === 'light' ? 'Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¯Ø§ÙƒÙ†' : 'Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„ÙØ§ØªØ­';
        }
    }

    function toggleTheme() {
        const newTheme = document.documentElement.className === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
    }

    function loadAndApplyTheme() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
    }

    // --- FULLSCREEN CONTROLS ---
    function toggleFullscreen() {
        if (isSlideshowActive) return;

        if (!document.fullscreenElement &&    // Standard
            !document.mozFullScreenElement && // Firefox
            !document.webkitFullscreenElement && // Chrome, Safari, Opera
            !document.msFullscreenElement) {  // IE/Edge
            
            const el = document.documentElement;
            if (el.requestFullscreen) {
                el.requestFullscreen();
            } else if (el.mozRequestFullScreen) { /* Firefox */
                el.mozRequestFullScreen();
            } else if (el.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                el.webkitRequestFullscreen();
            } else if (el.msRequestFullscreen) { /* IE/Edge */
                el.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }
    }

    function updateFullscreenIcon() {
        const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
        
        if (isSlideshowActive) {
             fullscreenIcon.classList.add('hidden');
             exitFullscreenIcon.classList.add('hidden');
             return;
        }

        fullscreenIcon.classList.toggle('hidden', isFullscreen);
        exitFullscreenIcon.classList.toggle('hidden', !isFullscreen);
        
        const fullscreenText = fullscreenBtn.querySelector('span');
        if (fullscreenText) {
            fullscreenText.textContent = isFullscreen ? "Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶" : "Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©";
        }
        fullscreenBtn.title = isFullscreen ? "Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©" : "Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©";
    }

    fullscreenBtn.addEventListener('click', toggleFullscreen);
    document.addEventListener('fullscreenchange', handleGeneralFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleGeneralFullscreenChange);
    document.addEventListener('mozfullscreenchange', handleGeneralFullscreenChange);
    document.addEventListener('MSFullscreenChange', handleGeneralFullscreenChange);

    // --- VIDEO LOADING & DISPLAY ---
    function renderSkeletonLoaders() {
        let skeletons = '';
        for (let i = 0; i < videosPerLoad; i++) {
            skeletons += '<div class="skeleton-card"><div class="skeleton-img"></div></div>';
        }
        videoContainer.innerHTML = skeletons;
    }

    function createVideoCard(videoData) {
        const card = document.createElement('div');
        card.className = 'video-card group relative rounded-xl overflow-hidden bg-[var(--surface-dark)] shadow-lg cursor-pointer transition-all duration-500 hover:shadow-[var(--accent)]/20 hover:-translate-y-1.5 hover:shadow-2xl border border-[var(--surface-light)]';
        card.onclick = () => openPopup(videoData.src);
        card.dataset.title = videoData.title.toLowerCase();
        card.dataset.duration = videoData.duration || "0"; 

        const spinnerContainer = document.createElement('div');
        spinnerContainer.className = 'absolute inset-0 flex items-center justify-center bg-[var(--surface-light)] h-48';
        spinnerContainer.innerHTML = `<div class="spinner"></div>`;

        const thumbnailVideo = document.createElement('video');
        const randomThumbnailTime = Math.floor(Math.random() * 4) + 1; 
        
        thumbnailVideo.src = videoData.src + '#t=' + randomThumbnailTime;
        thumbnailVideo.muted = true;
        thumbnailVideo.playsInline = true;
        thumbnailVideo.preload = 'metadata';
        thumbnailVideo.className = 'w-full h-48 object-cover transition-opacity duration-500 opacity-0';
        thumbnailVideo.style.pointerEvents = 'none'; 

        thumbnailVideo.addEventListener('loadedmetadata', () => {
            spinnerContainer.style.display = 'none'; 
            thumbnailVideo.classList.remove('opacity-0');
            const duration = thumbnailVideo.duration;
            card.dataset.duration = duration;
            const videoObj = allVideos.find(v => v.src === videoData.src);
            if (videoObj) {
                videoObj.duration = duration;
            }
        });

        thumbnailVideo.addEventListener('error', (e) => {
            spinnerContainer.innerHTML = `<span class="text-xs text-red-400 text-center p-2">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</span>`;
            console.error('Failed to load video metadata for thumbnail:', videoData.src, e);
        });

        const overlay = document.createElement('div');
        overlay.className = 'absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent';
        const infoContainer = document.createElement('div');
        infoContainer.className = 'absolute bottom-0 left-0 right-0 p-3 text-white';
        const title = document.createElement('h3');
        title.className = 'font-semibold text-sm truncate capitalize';
        title.textContent = videoData.title;
        
        const playIcon = document.createElement('div');
        playIcon.className = 'absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300';
        playIcon.innerHTML = `<div class="bg-black/50 rounded-full p-3 backdrop-blur-sm"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></div>`;

        infoContainer.appendChild(title);
        card.append(spinnerContainer, thumbnailVideo, overlay, infoContainer, playIcon);
        return card;
    }

    function loadMoreVideos() {
        const searchTerm = filterInput.value.toLowerCase();
        const videosToLoad = allVideos
            .filter(v => v.title.toLowerCase().includes(searchTerm))
            .slice(loadedVideosCount, loadedVideosCount + videosPerLoad);

        videosToLoad.forEach(video => {
            const card = createVideoCard(video);
            videoContainer.appendChild(card);
        });
        
        loadedVideosCount += videosToLoad.length;
        
        const totalMatching = allVideos.filter(v => v.title.toLowerCase().includes(searchTerm)).length;
        const remaining = totalMatching - loadedVideosCount;
        
        loadMoreButton.classList.toggle('hidden', remaining <= 0);
        if (remaining > 0) {
            loadMoreButton.textContent = `ØªØ­Ù…ÙŠÙ„ ${Math.min(videosPerLoad, remaining)} Ø§Ù„Ù…Ø²ÙŠØ¯`;
        }
    }


    function shuffleDisplayedVideos() {
        const cards = Array.from(videoContainer.querySelectorAll('.video-card:not(.hidden)'));
        cards.sort(() => Math.random() - 0.5);
        cards.forEach(card => videoContainer.appendChild(card)); 
    }

    function toggleSortByDuration() {
        // -1: random, 0: A-Z, 1: Longest, 2: Shortest
        currentSortState = (currentSortState + 1) % 4; 
        const sortBtnText = getEl('sortDurationText');
        
        allVideos.forEach(v => v.duration = parseFloat(v.duration || 0));
        
        if (currentSortState === 0) { // A-Z
            allVideos.sort((a, b) => (a.title || "").localeCompare(b.title || ""));
            if(sortBtnText) sortBtnText.textContent = "ÙØ±Ø²: Ø§ÙØªØ±Ø§Ø¶ÙŠ";
        } else if (currentSortState === 1) { // Longest
            allVideos.sort((a, b) => b.duration - a.duration);
            if(sortBtnText) sortBtnText.textContent = "ÙØ±Ø²: Ø§Ù„Ø£Ø·ÙˆÙ„";
        } else if (currentSortState === 2) { // Shortest
            allVideos.sort((a, b) => a.duration - a.duration);
            if(sortBtnText) sortBtnText.textContent = "ÙØ±Ø²: Ø§Ù„Ø£Ù‚ØµØ±";
        } else { // currentSortState === 3 (Back to random)
            allVideos.sort(() => Math.random() - 0.5);
            if(sortBtnText) sortBtnText.textContent = "ÙØ±Ø²: Ø¹Ø´ÙˆØ§Ø¦ÙŠ";
            currentSortState = -1; // Reset for next cycle
        }

        videoContainer.innerHTML = '';
        loadedVideosCount = 0;
        loadMoreVideos(); 
    }

    // --- SLIDESHOW FUNCTIONS (!!! Ù…ÙØ­Ø¯Ù‘Ø«Ø©) ---
    
    function handleGeneralFullscreenChange() {
        updateFullscreenIcon(); 
        
        if (!document.fullscreenElement && isSlideshowActive) {
            stopRandomSlideshow();
        }
    }

    function startRandomSlideshow() {
        if (allVideos.length === 0) {
            showNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶.", true);
            return;
        }
        
        isSlideshowActive = true;
        slideshowPlaylist = [...allVideos].sort(() => Math.random() - 0.5); // All videos
        currentSlideshowIndex = 0;
        
        startSlideshowPlayer();
    }
    
    function startPomfSlideshow() {
        const pomfVideos = allVideos.filter(video => video.src.includes('pomf'));
        
        if (pomfVideos.length === 0) {
            showNotification("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª 'pomf'.", true);
            return;
        }
        
        isSlideshowActive = true;
        slideshowPlaylist = [...pomfVideos].sort(() => Math.random() - 0.5); // Pomf videos only
        currentSlideshowIndex = 0;

        startSlideshowPlayer();
    }
    
    function startSlideshowPlayer() {
        slideshowContainer.classList.remove('hidden');
        
        if (slideshowContainer.requestFullscreen) {
            slideshowContainer.requestFullscreen();
        } else if (slideshowContainer.webkitRequestFullscreen) { /* Safari */
            slideshowContainer.webkitRequestFullscreen();
        }

        // !!! Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        isSlideshowLooping = false;
        slideshowVideo.loop = false;
        slideshowLoopBtn.classList.remove('active-accent');
        
        isSlideshowLocked = false;
        slideshowContainer.classList.remove('controls-hidden');
        lockOpenIcon.classList.remove('hidden');
        lockClosedIcon.classList.add('hidden');

        playSlideshowVideoAtIndex();
        
        slideshowVideo.onended = () => {
            if (!isSlideshowLooping) {
                playNextSlideshowVideo();
            }
        };
        slideshowVideo.onerror = () => {
             playNextSlideshowVideo(); // Skip on error
        };
    }

    // !!! ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ù€ index
    function playSlideshowVideoAtIndex() {
        if (currentSlideshowIndex < 0 || currentSlideshowIndex >= slideshowPlaylist.length) {
             stopRandomSlideshow(); // Safety check
             return;
        }
        slideshowVideo.src = slideshowPlaylist[currentSlideshowIndex].src;
        slideshowVideo.playbackRate = currentSpeed; 
        applyFilters(slideshowVideo);
        slideshowVideo.play();
    }

    // !!! ÙˆØ¸ÙŠÙØ© "Ø§Ù„ØªØ§Ù„ÙŠ" (ÙŠØ¯ÙˆÙŠØ©)
    function playNextSlideshowVideo() {
        if (!isSlideshowActive) return;
        currentSlideshowIndex = (currentSlideshowIndex + 1) % slideshowPlaylist.length;
        playSlideshowVideoAtIndex();
    }
    
    // !!! ÙˆØ¸ÙŠÙØ© "Ø§Ù„Ø³Ø§Ø¨Ù‚" (ÙŠØ¯ÙˆÙŠØ©)
    function playPrevSlideshowVideo() {
         if (!isSlideshowActive) return;
        currentSlideshowIndex = (currentSlideshowIndex - 1 + slideshowPlaylist.length) % slideshowPlaylist.length;
        playSlideshowVideoAtIndex();
    }
    
    // !!! ÙˆØ¸ÙŠÙØ© "ØªÙƒØ±Ø§Ø±"
    function toggleSlideshowLoop() {
        if (!isSlideshowActive) return;
        isSlideshowLooping = !isSlideshowLooping;
        slideshowVideo.loop = isSlideshowLooping;
        slideshowLoopBtn.classList.toggle('active-accent', isSlideshowLooping);
    }
    
    // !!! ÙˆØ¸ÙŠÙØ© "Ø§Ù„Ù‚ÙÙ„"
    function toggleSlideshowLock() {
        if (!isSlideshowActive) return;
        isSlideshowLocked = !isSlideshowLocked;
        slideshowContainer.classList.toggle('controls-hidden', isSlideshowLocked);
        lockOpenIcon.classList.toggle('hidden', isSlideshowLocked);
        lockClosedIcon.classList.toggle('hidden', !isSlideshowLocked);
    }


    function stopRandomSlideshow() {
        if (!isSlideshowActive) return; 
        
        isSlideshowActive = false;
        slideshowContainer.classList.add('hidden');
        slideshowVideo.pause();
        slideshowVideo.src = "";
        slideshowVideo.onended = null;
        slideshowVideo.onerror = null;
        slideshowPlaylist = [];
        
        // !!! Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
        isSlideshowLooping = false;
        isSlideshowLocked = false;
        slideshowContainer.classList.remove('controls-hidden');
        slideshowLoopBtn.classList.remove('active-accent');
        
        if (document.fullscreenElement) {
            document.exitFullscreen();
        }
    }


    // --- POPUP & PLAYER CONTROLS ---
    function toggleFilterSection() {
        const filterOptions = getEl('filterOptions');
        const filterButton = getEl('filterToggleButton');
        if (filterOptions && filterButton) {
            const isHidden = filterOptions.classList.toggle('hidden');
            filterButton.classList.toggle('bg-[var(--accent)]', !isHidden);
            filterButton.classList.toggle('text-white', !isHidden);
            if (!isHidden) {
                filterOptions.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
    }

    function openPopup(videoSrc) {
        if (isSlideshowActive) return;

        videoContainerPopup.innerHTML = `<video id="videoPlayer" class="w-full h-full object-contain" controls autoplay playsinline></video>`;
        const video = getEl('videoPlayer');
        video.src = videoSrc;
        
        const filterOptions = getEl('filterOptions');
        const filterButton = getEl('filterToggleButton');
        if (filterOptions) filterOptions.classList.add('hidden');
        if (filterButton) filterButton.classList.remove('bg-[var(--accent)]', 'text-white');
        
        videoPopup.classList.remove('invisible', 'opacity-0');
        videoPopupContent.classList.remove('popup-enter-from');
        
        videoPopup.scrollTop = 0;

        video.playbackRate = currentSpeed;
        applyFilters(video);
        
        video.loop = loopButton.classList.contains('bg-[var(--accent)]');
        video.onended = null; 
        
        video.addEventListener('error', () => {
             showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­.');
             closePopup();
        });
    }

    function closePopup() {
        if (isSlideshowActive) return;

        if (!videoPopup.classList.contains('invisible')) {
            videoPopupContent.classList.add('popup-enter-from');
            videoPopup.classList.add('opacity-0');
            setTimeout(() => {
                videoPopup.classList.add('invisible');
                videoContainerPopup.innerHTML = '';
            }, 300);
        }
        if (!infoPopup.classList.contains('invisible')) {
            infoPopup.querySelector('div').classList.add('popup-enter-from');
            infoPopup.classList.add('opacity-0');
            setTimeout(() => infoPopup.classList.add('invisible'), 300);
        }
    }
    
    function openInfoPopup() {
        infoPopup.classList.remove('invisible', 'opacity-0');
        infoPopup.querySelector('div').classList.remove('popup-enter-from');
    }
    
    function closeInfoPopup() {
        if (!infoPopup.classList.contains('invisible')) {
            infoPopup.querySelector('div').classList.add('popup-enter-from');
            infoPopup.classList.add('opacity-0');
            setTimeout(() => infoPopup.classList.add('invisible'), 300);
        }
    }

    function playRandomVideo() {
        if (isSlideshowActive) return;

        if (allVideos.length > 0) {
            const randomIndex = Math.floor(Math.random() * allVideos.length);
            openPopup(allVideos[randomIndex].src);
        }
    }

    async function shareVideo() {
        const video = getEl('videoPlayer');
        if (video && video.currentSrc) {
            try {
                await navigator.clipboard.writeText(video.currentSrc);
                showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ!', false);
            } catch (err) {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = video.currentSrc;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ!', false);
                } catch (fallbackErr) {
                    showNotification('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.');
                }
            }
        }
    }

    function toggleLoop() {
        if (isSlideshowActive) {
            return;
        }
        
        const video = getEl('videoPlayer');
        if (video) {
            video.loop = !video.loop;
            loopButton.classList.toggle('bg-[var(--accent)]', video.loop);
            loopButton.classList.toggle('text-white', video.loop);
        }
    }

    function setPlaybackSpeed(speed) {
        const video = getEl('videoPlayer');
        currentSpeed = speed; 
        if (video) {
            video.playbackRate = speed;
        }
        if (slideshowVideo) {
            slideshowVideo.playbackRate = speed; 
        }
        speedButtonText.textContent = `${speed}x`;
        document.querySelectorAll('.speed-option').forEach(opt => {
            opt.classList.toggle('active', parseFloat(opt.dataset.speed) === speed);
        });
    }

    // --- FILTER CONTROLS ---
    function applyFilters(video) {
        if (video) {
            const filterString = Object.entries(filterSettings)
                .map(([key, value]) => {
                    const unit = key === 'hue-rotate' ? 'deg' : key === 'blur' ? 'px' : '%';
                    return `${key}(${value}${unit})`;
                }).join(' ');
            video.style.filter = filterString;
        }
    }

    function createFilterSliders() {
        const filters = [
            { id: 'brightness', name: 'Ø§Ù„Ø³Ø·ÙˆØ¹', min: 0, max: 200, value: 100, unit: '%' },
            { id: 'contrast', name: 'Ø§Ù„ØªØ¨Ø§ÙŠÙ†', min: 0, max: 200, value: 100, unit: '%' },
            { id: 'saturate', name: 'Ø§Ù„ØªØ´Ø¨Ø¹', min: 0, max: 200, value: 100, unit: '%' },
            { id: 'hue-rotate', name: 'ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†', min: 0, max: 360, value: 0, unit: 'deg' },
            { id: 'blur', name: 'Ø§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ©', min: 0, max: 10, value: 0, unit: 'px' },
        ];
        
        const fragment = document.createDocumentFragment();
        filters.forEach(filter => {
            const container = document.createElement('div');
            container.innerHTML = `
                <div class="flex justify-between items-center text-sm mb-1">
                    <label for="${filter.id}" class="text-[var(--text-secondary)]">${filter.name}</label>
                    <span id="${filter.id}-value" class="text-[var(--text-primary)] font-mono">${filter.value}${filter.unit}</span>
                </div>
                <input type="range" id="${filter.id}" min="${filter.min}" max="${filter.max}" value="${filter.value}" class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-[var(--accent)]">
            `;
            fragment.append(container); 
        });
        
        if (filterSlidersContainer) {
            filterSlidersContainer.innerHTML = ''; 
            filterSlidersContainer.append(fragment);
        }

        filters.forEach(filter => {
            const slider = getEl(filter.id);
            if (slider) {
                slider.addEventListener('input', (e) => {
                    const video = getEl('videoPlayer');
                    filterSettings[filter.id] = e.target.value;
                    getEl(`${filter.id}-value`).textContent = `${e.target.value}${filter.unit}`;
                    if(video) applyFilters(video);
                    if (slideshowVideo) applyFilters(slideshowVideo);
                });
            }
        });
    }

    function resetFilters() {
        filterSettings = { ...defaultFilterSettings };
        const video = getEl('videoPlayer');
        if(video) applyFilters(video);
        if(slideshowVideo) applyFilters(slideshowVideo);

        Object.entries(filterSettings).forEach(([key, value]) => {
            const slider = getEl(key);
            if (slider) {
                slider.value = value;
                const unit = key === 'hue-rotate' ? 'deg' : key === 'blur' ? 'px' : '%';
                const valueEl = getEl(`${key}-value`);
                if(valueEl) {
                    valueEl.textContent = `${value}${unit}`;
                }
            }
        });
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', createFilterSliders);

    filterInput.addEventListener('input', (e) => {
        videoContainer.innerHTML = '';
        loadedVideosCount = 0;
        loadMoreVideos(); 
    });


    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !isSlideshowActive) {
             closePopup();
        }
        
        if (!['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
            // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            if (!isSlideshowActive && videoPopup.classList.contains('opacity-0') === false) {
                const video = getEl('videoPlayer');
                if (video) {
                    if ([' ', 'f', 'm', 'arrowright', 'arrowleft'].includes(e.key.toLowerCase())) {
                        e.preventDefault();
                    }

                    switch(e.key.toLowerCase()) {
                        case ' ': video.paused ? video.play() : video.pause(); break;
                        case 'f': 
                            if (document.fullscreenElement) {
                                document.exitFullscreen();
                            } else {
                                videoPopupContent.requestFullscreen().catch(err => {
                                    console.error("Error attempting to enable full-screen mode:", err.message, err.name);
                                    video.requestFullscreen();
                                });
                            }
                            break;
                        case 'm': video.muted = !video.muted; break;
                        case 'arrowright': video.currentTime += 5; break;
                        case 'arrowleft': video.currentTime -= 5; break;
                    }
                }
            }
            // !!! Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
            else if (isSlideshowActive) {
                if ([' ', 'l', 'arrowright', 'arrowleft'].includes(e.key.toLowerCase())) {
                    e.preventDefault();
                }
                switch(e.key.toLowerCase()) {
                    case ' ': slideshowVideo.paused ? slideshowVideo.play() : slideshowVideo.pause(); break;
                    case 'arrowright': playNextSlideshowVideo(); break;
                    case 'arrowleft': playPrevSlideshowVideo(); break;
                    case 'l': toggleSlideshowLoop(); break;
                }
            }
        }
    });
    
    const observer = new IntersectionObserver(
        ([entry]) => {
            appHeader.classList.toggle('opacity-0', entry.isIntersecting);
            appHeader.classList.toggle('-translate-y-full', entry.isIntersecting);
            if (document.hasFocus()) {
                 entry.isIntersecting ? heroVideo.play().catch(()=>{}) : heroVideo.pause();
            }
        },
        { threshold: 0.1 }
    );
    if(heroBanner) observer.observe(heroBanner);
    
    </script>
</body>
</html>

